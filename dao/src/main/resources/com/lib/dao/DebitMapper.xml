<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.lib.dao.DebitMapper">
    <resultMap id="BaseResultMap" type="com.lib.model.Debit">
        <id column="debit_id" jdbcType="INTEGER" property="debitId"/>
        <result column="return_deadline" jdbcType="DATE" property="returnDeadline"/>
        <result column="return_date" jdbcType="DATE" property="returnDate"/>
        <result column="create_by" jdbcType="INTEGER" property="createBy"/>
        <result column="create_time" jdbcType="TIMESTAMP" property="createTime"/>
        <result column="update_by" jdbcType="INTEGER" property="updateBy"/>
        <result column="update_time" jdbcType="TIMESTAMP" property="updateTime"/>
        <result column="revision" jdbcType="INTEGER" property="revision"/>
        <association property="book" javaType="com.lib.model.Book" column="{id=book_id}"
                     select="com.lib.dao.BookMapper.getById" />
    </resultMap>
    <select id="getBy" parameterType="com.lib.model.Parameter" resultMap="BaseResultMap">
        select distinct d.`debit_id`,
                        d.`book_id`,
                        d.`return_deadline`,
                        d.`return_date`,
                        d.`create_by`,
                        d.`create_time`,
                        d.`update_by`,
                        d.`update_time`,
                        d.`revision`
        from debit d
    </select>

    <select id="getById" parameterType="com.lib.model.Parameter" resultMap="BaseResultMap">
        select distinct d.`debit_id`,
                        d.`book_id`,
                        d.`return_deadline`,
                        d.`return_date`,
                        d.`create_by`,
                        d.`create_time`,
                        d.`update_by`,
                        d.`update_time`,
                        d.`revision`
        from debit d
        where d.`debit_id` = #{id}
    </select>

    <delete id="delete" parameterType="com.lib.model.Parameter">
        delete
        from debit d
        where d.`debit_id` = #{id}
    </delete>

    <insert id="create" parameterType="com.lib.model.Parameter" useGeneratedKeys="true" keyColumn="debit.debitId">
        insert into debit (`book_id`, `return_deadline`,
                           `return_date`, `create_by`, `create_time`,
                           `update_by`, `update_time`, `revision`)
        values (#{debit.book.bookId}, #{debit.returnDeadline},
                #{debit.returnDate}, #{debit.createBy}, NOW(),
                #{debit.updateBy}, NOW(), #{debit.revision})
    </insert>

    <update id="update" parameterType="com.lib.model.Parameter">
        update debit d
        <set>
            <if test="debit.book != null and debit.book.bookId != null">
                d.`book_id` = #{debit.book.bookId,jdbcType=INTEGER},
            </if>
            <if test="debit.returnDeadline != null">
                d.`return_deadline` = #{debit.returnDeadline,jdbcType=DATE},
            </if>
            <if test="debit.returnDate != null">
                d.`return_date` = #{debit.returnDate,jdbcType=DATE},
            </if>
            <if test="debit.updateBy != null">
                d.`update_by` = #{debit.updateBy,jdbcType=INTEGER},
            </if>
            <if test="debit.updateTime != null">
                d.`update_time` = NOW(),
            </if>
            <if test="debit.revision != null">
                d.`revision` = #{debit.revision,jdbcType=INTEGER},
            </if>
        </set>
        where d.`debit_id` = #{id}
    </update>
</mapper>